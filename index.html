<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>Trump Draws</title>
</head>
<body>

<!-- Scripts -->
<script src='libgif.js'></script>
<script src='gif.js'></script>
<script src='download.js'></script>
<!-- Dev -->
<script src='live_reload.js'></script>

<link rel="stylesheet" type="text/css" href="reset.css">
<style>
  body {
    font-family: Helvetica;
  }
  h1 {
    font-size: 20px;
  }
  canvas {
    vertical-align: top;
  }
</style>

<div>
  <section class='canvases'>
    <!-- These dimensions are hard-coded -->

    <canvas id='result' width="600" height="521"></canvas>
    <h1>Trump</h1>
    <img id="example1" src="./trump.gif" width="600" height="521" rel:auto_play="1" />
    <hr />
    <button id='button'>BUTTON</button>
    <button id='download'>Download</button>




    <h1>Draw</h1>
    <canvas id='drawing' width="600" height="521"></canvas>
    <h1>Result</h1>
  </section>
</div>

<script>
  var WIDTH = 600;
  var HEIGHT = 521;
  var FRAME_COUNT = 87; // Hardcoded
  /**
   * pageCorners: This contains an array from [0..FRAME_COUNT) of the pages
   * - leftPage, rightPage: left and right pages (from observer's perspective)
   *   - [x1, y1, x2, y2, x3, y3, x4, y4] - tl, tr, br, bl
   */
  var pageCorners = [
    [555,493,399,517,292,441,432,423, 385,520,226,564,123,468,279,444],
    [537,484,403,513,276,442,406,417, 393,519,243,568,111,472,261,442],
    [508,459,417,502,243,447,342,408, 405,508,285,570,111,495,232,448],
    [454,438,403,489,199,450,267,403,397,492,301,599,109,513,196,451],
    [417,427,390,475,177,453,222,402,387,481,340,572,115,517,177,454],
    [376,408,382,460,168,451,184,400,382,466,384,529,142,522,168,457],
    [357,402,382,450,175,454,174,402,385,457,412,520,180,522,177,456],
    [359,402,384,450,177,454,176,402,387,457,414,520,182,522,179,456],
    [363,402,388,450,181,454,180,402,391,457,418,520,186,522,183,456],
    [363,402,388,450,181,454,180,402,391,457,418,520,186,522,183,456],
    [337,390,370,444,174,453,159,396,375,451,414,510,192,520,174,457],

    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0],
    [0,0,10,10, 0,0,10,10, 0,0,0,0, 0,0,0,0]
  ];

  // Control the GIF
  var sup1 = new SuperGif({
    gif: document.getElementById('example1'),
    progressbar_height: 0,
  });
  sup1.load(function() {
    console.log('loaded');




    sup1.pause()
    sup1.move_to(0);
  });
  // sup1.pause()
  // sup1.move_to(0);

  var coord = []; //temp
  var i = 0;
  function next() {
    sup1.move_to(i);
    console.log('frame', i);
    // sup1.pause()


    console.log(coord);
    coord = [];


    //grab the context from your destination canvas
    var destCtx = result.getContext('2d');
    destCtx.drawImage(sup1.get_canvas(), 0, 0);
    destCtx.beginPath();
    var x = 100;
    var y = 100;
    var w = 10;
    var h = 30;
    // destCtx.rect(x, y, w, h);
    destCtx.beginPath();
    var leftPage = pageCorners[i];
    var rightPage = pageCorners[i].splice(8);
    var xOffset = -3;
    var yOffset = -7;
    destCtx.moveTo(leftPage[0] + xOffset, leftPage[1] + yOffset);
    destCtx.lineTo(leftPage[2] + xOffset, leftPage[3] + yOffset);
    destCtx.moveTo(leftPage[2] + xOffset, leftPage[3] + yOffset);
    destCtx.lineTo(leftPage[4] + xOffset, leftPage[5] + yOffset);
    destCtx.moveTo(leftPage[4] + xOffset, leftPage[5] + yOffset);
    destCtx.lineTo(leftPage[6] + xOffset, leftPage[7] + yOffset);
    destCtx.moveTo(leftPage[6] + xOffset, leftPage[7] + yOffset);
    destCtx.lineTo(leftPage[0] + xOffset, leftPage[1] + yOffset);
    destCtx.closePath();
    destCtx.moveTo(rightPage[0] + xOffset, rightPage[1] + yOffset);
    destCtx.lineTo(rightPage[2] + xOffset, rightPage[3] + yOffset);
    destCtx.moveTo(rightPage[2] + xOffset, rightPage[3] + yOffset);
    destCtx.lineTo(rightPage[4] + xOffset, rightPage[5] + yOffset);
    destCtx.moveTo(rightPage[4] + xOffset, rightPage[5] + yOffset);
    destCtx.lineTo(rightPage[6] + xOffset, rightPage[7] + yOffset);
    destCtx.moveTo(rightPage[6] + xOffset, rightPage[7] + yOffset);
    destCtx.lineTo(rightPage[0] + xOffset, rightPage[1] + yOffset);
    destCtx.closePath();


    destCtx.strokeStyle = 'red';
    destCtx.strokeWidth = '4px';
    // destCtx.fill();
    destCtx.stroke();

    // var result = sup1.get_canvas();
    // console.log(result);
    i += 1;
    i = i % FRAME_COUNT;
  }
  document.getElementById('button').onclick = next;
  window.onkeypress = next;

  window.onclick = function(e) {
    coord.push(e.clientX, e.clientY);
  }


  // Draw the GIF
  var drawing = document.getElementById('drawing');
  var context = drawing.getContext('2d'); // starts all black
  // context.fillStyle = 'rgb(255,255,255)';
  // context.fillRect(0,0,drawing.width, drawing.height); //GIF can't do transparent so do white

  context.fillStyle = 'rgb(255,255,0)';
  context.fillRect(10,10,drawing.width/2, drawing.height/2); //GIF can't do transparent so do white

  // context.fillStyle = 'rgb(200,0,0)';
  // context.fillRect (10, 10, 75, 50);   //draw a little red box

  // encoder/downloader
  var encoder = new GIFEncoder();
  encoder.setRepeat(0); //0  -> loop forever
                        //1+ -> loop n times then stop
  encoder.setDelay(100); //go to next frame every n milliseconds
  encoder.start();

  // Change the canvas, then addFrame
  encoder.addFrame(context);
  // context.fillRect (0, 0, 75, 50);   //draw a little red box
  // encoder.addFrame(context);

  encoder.finish();

  /**
   * Download button click handler
   */
  document.getElementById('download').onclick = function() {
    console.log('download');
    downloadGIF();
  }

  // Downloads the GIF
  function downloadGIF() {
    var FILE_NAME = 'trump-draws.gif';
    var binary_gif = encoder.stream().getData() //notice this is different from the as3gif package!
    var data_url = 'data:image/gif;base64,'+encode64(binary_gif);
    download(data_url, FILE_NAME, 'image/gif');
  }
</script>




</body>
</html>

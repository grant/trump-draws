<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>Trump Draws</title>
</head>
<body>

<!-- Scripts -->
<script src='libgif.js'></script>
<script src='gif.js'></script>
<script src='download.js'></script>
<!-- Dev -->
<script src='live_reload.js'></script>

<link rel="stylesheet" type="text/css" href="reset.css">
<style>
  body {
    font-family: Helvetica;
  }
  h1 {
    font-size: 20px;
  }
  canvas {
    vertical-align: top;
  }
</style>

<div>
  <section class='canvases'>
    <!-- These dimensions are hard-coded -->
    <h1>Draw</h1>
    <canvas id='drawing' width="600" height="521"></canvas>
    <h1>Result</h1>
    <canvas id='result' width="600" height="521"></canvas>
    <h1>Trump</h1>
    <img id="example1" src="./trump.gif" width="600" height="521" rel:auto_play="1" />
    <hr />
    <button id='button'>BUTTON</button>
    <button id='download'>Download</button>
  </section>
</div>

<script>
  var WIDTH = 600;
  var HEIGHT = 521;
  var FRAME_COUNT = 87; // Hardcoded
  /**
   * pageCorners: This contains an array from [0..FRAME_COUNT) of the pages
   * - leftPage, rightPage: left and right pages (from observer's perspective)
   *   - [x1, y1, x2, y2, x3, y3, x4, y4] - tl, tr, br, bl
   */
  var pageCorners = [
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
    { leftPage: [0,0,10,10, 0,0,10,10], rightPage: [0,0,0,0, 0,0,0,0] },
  ];

  // Control the GIF
  var sup1 = new SuperGif({
    gif: document.getElementById('example1'),
    progressbar_height: 0,
  });
  sup1.load(function() {
    console.log('loaded');




    sup1.pause()
    sup1.move_to(0);
  });
  // sup1.pause()
  // sup1.move_to(0);
  var i = 0;
  document.getElementById('button').onclick = function() {
    sup1.move_to(i);
    console.log('frame', i);
    // sup1.pause()


    //grab the context from your destination canvas
    var destCtx = result.getContext('2d');
    destCtx.drawImage(sup1.get_canvas(), 0, 0);
    destCtx.beginPath();
    destCtx.moveTo(20,20);
    destCtx.lineTo(20,100);
    destCtx.lineTo(70,100);
    destCtx.closePath();


    destCtx.strokeStyle = 'red';
    destCtx.strokeWidth = '4px';
    // destCtx.fill();
    destCtx.stroke();

    // var result = sup1.get_canvas();
    // console.log(result);
    i += 1;
    i = i % FRAME_COUNT;
  }


  // Draw the GIF
  var drawing = document.getElementById('drawing');
  var context = drawing.getContext('2d'); // starts all black
  // context.fillStyle = 'rgb(255,255,255)';
  // context.fillRect(0,0,drawing.width, drawing.height); //GIF can't do transparent so do white

  context.fillStyle = 'rgb(255,255,0)';
  context.fillRect(10,10,drawing.width/2, drawing.height/2); //GIF can't do transparent so do white

  // context.fillStyle = 'rgb(200,0,0)';
  // context.fillRect (10, 10, 75, 50);   //draw a little red box

  // encoder/downloader
  var encoder = new GIFEncoder();
  encoder.setRepeat(0); //0  -> loop forever
                        //1+ -> loop n times then stop
  encoder.setDelay(100); //go to next frame every n milliseconds
  encoder.start();

  // Change the canvas, then addFrame
  encoder.addFrame(context);
  // context.fillRect (0, 0, 75, 50);   //draw a little red box
  // encoder.addFrame(context);

  encoder.finish();

  /**
   * Download button click handler
   */
  document.getElementById('download').onclick = function() {
    console.log('download');
    downloadGIF();
  }

  // Downloads the GIF
  function downloadGIF() {
    var FILE_NAME = 'trump-draws.gif';
    var binary_gif = encoder.stream().getData() //notice this is different from the as3gif package!
    var data_url = 'data:image/gif;base64,'+encode64(binary_gif);
    download(data_url, FILE_NAME, 'image/gif');
  }
</script>




</body>
</html>
